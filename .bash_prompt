#!/usr/bin/env bash
# assume terminal supports ANSI esc-codes

last_exit() {
	local e=$?
	# inlining args breaks the prompt
	[ $e -ne 0 ] && printf "${1:-}%02x${2:-}" $e
	return $e
}

# bold; red exit; blue WD to match `ls`
PS1='\n\[\e[1m\]$(last_exit "\[\e[31m\]" "\[\e[0;1m\] ")\[\e[34m\]\w\[\e[0;1m\]'

if command -v git >/dev/null; then
	# ⚡ fast commit-ish
	git_c_name() {
		git rev-parse --is-inside-work-tree &>/dev/null || return
		echo " ${1:-}$(\
			git symbolic-ref --quiet --no-recurse --short HEAD 2>/dev/null || \
			git describe --all --exact-match HEAD 2>/dev/null || \
			git rev-parse --short HEAD 2>/dev/null || \
			echo '(?)' \
		)${2:-}"
	}
	# yellow, because Git is orange, and it complements blue
	PS1+='$(git_c_name "\[\e[33m\]" "\[\e[0;1m\]")'
fi

PS1+='\n\[\e[1m\]Δ \[\e[0m\]'
# terminals struggle styling across lines:
# https://github.com/mathiasbynens/dotfiles/issues/930
